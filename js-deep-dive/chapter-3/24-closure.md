---
description: 클로저에 대해 알아봅시다.
---

# 클로저
MDN에서는 클로저를 당므과 같이 정의하고 있다. **클로저는 함수와 그 함수가 선언된 렉시컬 환경과의 조합이다.** <br>
정의만으로는 알기 어려운 개념이기에, 자바스크립트의 동작 방식과 연관지어 이해하는 것이 좋다. <br>

# 렉시컬 스코프
자바스크립트 엔진은 함수를 어디서 호출했는지가 아니라 함수를 어디에 정의했는지에 따라 상위 스코프를 결정하는데 이를 렉시컬 스코프(정적 스코프)라고 한다. <br>

위 설명처럼 자바스크립트에서의 스코프는 실행 컨텍스트의 렉시컬 환경이다. 그리고 이 렉시컬 환경은 자신의 **외부 렉시컬 환경에 대한 참조**를 통해 상위 렉시컬 환경과 연결되는데 이게 바로 **스코프 체인**이다. <br>

그래서 위 개념을 적용해 다시 한 번 렉시컬 스코프를 정의해보면 다음과 같다.
<br>
렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 저장할 참조값, 즉 상위 스코프에 대한 참조는 함수 정의가 평가되는 시점에 함수가 정의된 환경에 의해 결정된다. 이것이 바로 렉시컬 스코프이다.<br>

# 함수 객체의 내부 슬롯 [[Environment]]
함수가 정의된 환경(위치)과 호출되는 환경(위치)은 다를 수 있다. 따라서 렉시컬 스코프가 가능하려면 함수는 자신이 호출되는 환경과는 상관없이 자신이 정의된 환경인 상위 스코프를 기억해야 하며, 함수는 자신의 **내부 슬롯**에 자신이 정의된 환경인 상위 스코프의 참조를 저장한다. <br>
함수 객체는 내부 슬롯 `[[Environment]]`에 저장한 렉시컬 환경의 참조, 상위 스코프를 자신이 존재하는 한 기억한다. <br>

# 클로저와 렉시컬 환경
```
function outer() {
    const x = 10;
    const inner = function () { console.log(x); }
    return inner;
}

const innerFunc = outer();
innerFunc(); // 10
```
위 예제에서 `outer`의 내부 함수인 inner를 반환하고 생명 주기를 마감한다. 따라서 지역 변수인 x도 같이 생을 마감한다. <br>
하지만 `innerFunc()`을 호출했을 때 콘솔에는 10이라는 값이 적힌다. 이처럼 **외부 함수보다 중첩 함수가 더 오래 유지되는 경우 중첩 함수는 이미 생명 주기가 종료된 외부 함수의 변수를 참조할 수 있으며, 이러한 중첩 함수를 클로저라고 부른다.** <br>

자바스크립트는 가비지 컬렉터에 의해 사용하지 않는 메모리 즉, 참조되지 않는 메모리를 정리하는데, 위의 경우 클로저가 외부 함수의 변수를 참조하고 있으므로 외부 함수의 변수인 `x`가 소멸되지 않는 것이다. <br>

자바스크립트의 모든 함수는 상위 스코프를 기억하므로 이론적으로는 모든 함수는 클로저이지만 **중첩 함수가 상위 스코프의 식별자를 참조하고 있고 중첩 함수가 외부 함수보다 더 오래 유지되는 경우에 한정하는 것이 일반적이다.** <br>

클로저에 의해 참조되는 상위 스코프의 변수를 **자유 변수**라고 하며 **클로저란 함수가 자유 변수에 대해 닫혀있다**라는 의미이다. 이를 알기 쉽게 의역해보자면 "자유 변수에 묶여있는 함수"라고 할 수 있다. <br>

클로저는 상위 스코프를 기억해야하므로 불필요한 메모리를 저장한다고 생각할 수 있지만, 자바스크립트 엔진의 최적화로 인해 클로저가 참조하고 있지 않은 식별자는 기억하지 않는다. <br>